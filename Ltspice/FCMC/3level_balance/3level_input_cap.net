* C:\GitHub\research-simulation\Ltspice\FCMC\3level_balance\3level_input_cap.asc
V2 N005 0 PULSE(0 1 0 1p 1p {1/freq*(1-duty)} {1/freq})
A1 N005 0 0 0 0 0 Ph1 0 BUF
V§Source Vin 0 {Vin}
S11 nc1t sw Ph2b 0 MYSWL
S12 N001 nc1t Ph1b 0 MYSWH
V3 N006 0 PULSE(0 1 {1/freq/2+delay} 1p 1p {1/freq*(1-duty)-delay+delay2} {1/freq})
A3 N006 0 0 0 0 0 Ph2 0 BUF
S5 nc1b sw Ph2 0 MYSWH
S6 0 nc1b Ph1 0 MYSWL
C2 nc1t nc1b {C} Rser={ESR} IC={Vin/2}
L sw N002 100µ Rser=20m ic = {Iload}
C10 N002 0 25µ IC={Vin*duty} Rser=1m
V8 N003 0 PULSE(0 1 {1/freq*(1-duty)+dead+delay} 1p 1p {1/freq*duty-dead*2-delay+delay2} {1/freq})
A8 N003 0 0 0 0 0 Ph1b 0 BUF
V9 N004 0 PULSE(0 1 {1/freq/2+1/freq*(1-duty)+dead} 1p 1p {1/freq*duty-dead*2} {1/freq})
A9 N004 0 0 0 0 0 Ph2b 0 BUF
D1 0 nc1b MyDiode
D2 nc1b sw MyDiode
D7 nc1t N001 MyDiode
D8 sw nc1t MyDiode
I1 N002 0 {Iload}
C1 vin2 0 {cin} Rser=2m ic = {vin}
R1 0 0 2000m
L1 Vin vin2 {lin} Rser=10m
V§Source1 vin2 N001 0
.model D D
.lib C:\PROGRA~2\LTC\LTSPIC~1\lib\cmp\standard.dio
.tran 0 {200m + 4/freq} 200m uic
.model MYSWH SW(Ron=10m Roff=1Meg Vt=.5)
.model MYSWL SW(Ron=10m Roff=1Meg Vt=.5)
.model MyDiode D(Ron=2m Roff=1Meg Vfwd=2)
.param delay=0n delay2=0n
.param freq=120k
.param duty=0.75 Vin= 400 Iload = 4
.param dead=40n
.param C = 0.5u ESR = 5m 
.param cin = 300u lin = 100n
.meas TRAN S2max MAX V(sw)-V(nc1b)
.meas TRAN S1max MAX V(nc1b)
.meas TRAN Vc1 AVG V(nc1t)-V(nc1b)
.meas TRAN Vin AVG V(vin)
.meas TRAN S2bmax MAX V(nc1t) - V(sw)
.meas TRAN S1bmax MAX V(Vin2) - V(sw)
*.step param C list 2.2u 1.1u
*.step param Rload list 10 5
*.step param delay2 list 1.5n 3n
*.step param Iload 0.1 5.1 1
.step dec param cin 3u 300u 10
.backanno
.end
